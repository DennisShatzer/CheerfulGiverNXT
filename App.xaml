<Application x:Class="CheerfulGiverNXT.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Default theme for designer + first-paint fallback. ThemeManager swaps this at runtime. -->
                <ResourceDictionary Source="Themes/Light.xaml"/>
            </ResourceDictionary.MergedDictionaries>

<!-- Intentionally minimal.
             Each Window defines its own local styles in Window.Resources
             to make editing simple and isolated. -->

        <!--
            Global DataGrid column header theming
            =====================================
            Problem:
              - WPF DataGrid column headers use SystemColors by default.
              - SystemColors do NOT automatically switch for Light/Dark unless you are in High Contrast
                or using a theming framework.
              - Result: headers look "stuck" in Light Mode when the rest of the UI is themed.

            Solution:
              - Provide a default Style for DataGridColumnHeader that uses our theme brushes.
              - Uses DynamicResource so it switches live when ThemeManager swaps Light/Dark.

            Brush keys (tune in Themes/Light.xaml + Themes/Dark.xaml):
              - CG.Brush.GridHeaderBackground
              - CG.Brush.GridHeaderForeground
              - CG.Brush.GridHeaderHoverBackground
              - CG.Brush.GridHeaderPressedBackground
              - CG.Brush.GridHeaderBorder
        -->
        <Style TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Padding" Value="10,0,10,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="FontWeight" Value="SemiBold"/>

            <Setter Property="Background" Value="{DynamicResource CG.Brush.GridHeaderBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.GridHeaderForeground}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.GridHeaderBorder}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridColumnHeader}">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                SnapsToDevicePixels="True">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="16"/>
                                </Grid.ColumnDefinitions>

                                <ContentPresenter Grid.Column="0"
                                                  Margin="{TemplateBinding Padding}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  RecognizesAccessKey="True"/>

                                <Path x:Name="SortArrow"
                                      Grid.Column="1"
                                      Width="8" Height="6"
                                      Margin="0,0,8,0"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right"
                                      Fill="{DynamicResource CG.Brush.GridHeaderForeground}"
                                      Data="M 0 6 L 4 0 L 8 6 Z"
                                      Visibility="Collapsed"/>

                                <!-- Required by DataGrid for column resizing -->
                                <Thumb x:Name="PART_LeftHeaderGripper"
                                       HorizontalAlignment="Left"
                                       Width="6"
                                       Background="Transparent"
                                       Cursor="SizeWE"/>
                                <Thumb x:Name="PART_RightHeaderGripper"
                                       HorizontalAlignment="Right"
                                       Width="6"
                                       Background="Transparent"
                                       Cursor="SizeWE"/>
                            </Grid>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource CG.Brush.GridHeaderHoverBackground}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource CG.Brush.GridHeaderPressedBackground}"/>
                            </Trigger>

                            <Trigger Property="SortDirection" Value="Ascending">
                                <Setter TargetName="SortArrow" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="SortArrow" Property="RenderTransform">
                                    <Setter.Value><RotateTransform Angle="0"/></Setter.Value>
                                </Setter>
                                <Setter TargetName="SortArrow" Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>
                            <Trigger Property="SortDirection" Value="Descending">
                                <Setter TargetName="SortArrow" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="SortArrow" Property="RenderTransform">
                                    <Setter.Value><RotateTransform Angle="180"/></Setter.Value>
                                </Setter>
                                <Setter TargetName="SortArrow" Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextMuted}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        </ResourceDictionary>
    </Application.Resources>
</Application>
