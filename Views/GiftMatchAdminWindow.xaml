<Window x:Class="CheerfulGiverNXT.GiftMatchAdminWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Admin: Gift Match Challenges"
        Width="980"
        Height="680"
        MinWidth="820"
        MinHeight="560"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource CG.Brush.WindowBackground}" Foreground="{DynamicResource CG.Brush.TextPrimary}">

    <Window.Resources>

        <sys:Double x:Key="Font.Base">16</sys:Double>
        <sys:Double x:Key="Input.Height">34</sys:Double>
        <Thickness x:Key="Input.Padding">10,6,10,6</Thickness>
        <CornerRadius x:Key="Corner.Button">6</CornerRadius>

        <Style x:Key="BodyText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>
        <Style TargetType="TextBlock" BasedOn="{StaticResource BodyText}"/>

        <Style x:Key="MutedText" TargetType="TextBlock" BasedOn="{StaticResource BodyText}">
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextMuted}"/>
        </Style>

        <Style x:Key="InputTextBox" TargetType="TextBox">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="Padding" Value="{StaticResource Input.Padding}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.InputBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.InputBorder}"/>
        </Style>

        <ControlTemplate x:Key="ButtonTemplate.Rounded" TargetType="Button">
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{StaticResource Corner.Button}">
                <ContentPresenter Margin="{TemplateBinding Padding}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  RecognizesAccessKey="True"
                                  TextElement.Foreground="{TemplateBinding Foreground}"/>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True"><Setter Property="Opacity" Value="0.92"/></Trigger>
                <Trigger Property="IsPressed" Value="True"><Setter Property="Opacity" Value="0.85"/></Trigger>
                <Trigger Property="IsEnabled" Value="False"><Setter Property="Opacity" Value="0.55"/></Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style x:Key="Button.Primary" TargetType="Button">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="MinWidth" Value="170"/>
            <Setter Property="Padding" Value="14,4"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.Accent}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.Accent}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.AccentForeground}"/>
            <Setter Property="Template" Value="{StaticResource ButtonTemplate.Rounded}"/>
        </Style>

        <Style x:Key="Button.Secondary" TargetType="Button">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="MinWidth" Value="150"/>
            <Setter Property="Padding" Value="14,4"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.SurfaceAlt}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.BorderStrong}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextPrimary}"/>
            <Setter Property="Template" Value="{StaticResource ButtonTemplate.Rounded}"/>
        </Style>

        <Style x:Key="HeaderCard" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource CG.Brush.Surface}"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="SectionGroupBox" TargetType="GroupBox">
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.Surface}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="FormLabel" TargetType="TextBlock" BasedOn="{StaticResource MutedText}">
            <Setter Property="Margin" Value="0,0,0,2"/>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="RowHeight" Value="34"/>
            <Setter Property="ColumnHeaderHeight" Value="36"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{DynamicResource CG.Brush.GridLines}"/>
            <Setter Property="VerticalGridLinesBrush" Value="Transparent"/>
            <Setter Property="AlternatingRowBackground" Value="{DynamicResource CG.Brush.GridAltRow}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.Surface}"/>
            <Setter Property="RowBackground" Value="{DynamicResource CG.Brush.Surface}"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextPrimary}"/>
        </Style>

    </Window.Resources>

    <Grid Margin="18" HorizontalAlignment="Center" MaxWidth="1100">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Style="{StaticResource HeaderCard}">
            <StackPanel>
                <TextBlock Text="Gift Match Challenges" FontSize="22" FontWeight="SemiBold"/>
                <TextBlock Style="{StaticResource MutedText}" Margin="0,8,0,0">
                    Create and manage anonymous matching-gift challenges.
                    Matching is applied oldest-first until budget is exhausted.
                    <LineBreak/>
                    Hotkey: <Run FontWeight="SemiBold">Ctrl+Shift+C</Run>
                </TextBlock>

                <TextBlock Margin="0,12,0,0" FontFamily="Consolas" Text="{Binding CampaignLabel}"/>
            </StackPanel>
        </Border>

        <!-- Body -->
        <ScrollViewer Grid.Row="1" Margin="0,16,0,0" VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <GroupBox Header="Anonymous matcher" Style="{StaticResource SectionGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Style="{StaticResource MutedText}">
                            Set the Constituent ID that represents your anonymous match donor.
                            Matching gifts are stored locally in SQL Express and are not sent to SKY API.
                            This should be a dedicated "Anonymous Match Donor" constituent in Raiserâ€™s Edge NXT (for reporting/audit).
                        </TextBlock>

                        <Grid Grid.Row="1" Margin="0,14,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="260"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,14,0" VerticalAlignment="Center">
                                <TextBlock Style="{StaticResource FormLabel}" Text="Anonymous Constituent ID"/>
                                <TextBlock Style="{StaticResource MutedText}" FontSize="14">(stored in CGAppSettings)</TextBlock>
                            </StackPanel>

                            <TextBox Grid.Column="1" Style="{StaticResource InputTextBox}"
                                     Text="{Binding AnonymousConstituentIdText, UpdateSourceTrigger=PropertyChanged}" />

                            <Button x:Name="SaveAnonButton" Grid.Column="2" Margin="12,0,0,0" Content="Save"
                                    Style="{StaticResource Button.Primary}"
                                    IsEnabled="{Binding CanSaveAnonymousId}" />
                        </Grid>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Create a new match challenge" Style="{StaticResource SectionGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Style="{StaticResource MutedText}">
                            Challenge budget is the maximum total match amount. When the budget reaches $0 remaining, the challenge automatically deactivates.
                        </TextBlock>

                        <Grid Grid.Row="1" Margin="0,14,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="220"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,14,0">
                                <TextBlock Style="{StaticResource FormLabel}" Text="Challenge name"/>
                                <TextBox Style="{StaticResource InputTextBox}"
                                         Text="{Binding ChallengeName, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="0,0,14,0">
                                <TextBlock Style="{StaticResource FormLabel}" Text="Budget"/>
                                <TextBox Style="{StaticResource InputTextBox}"
                                         Text="{Binding ChallengeBudgetText, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>

                            <Button x:Name="CreateChallengeButton" Grid.Column="2" Content="Create"
                                    Style="{StaticResource Button.Primary}"
                                    IsEnabled="{Binding CanCreateChallenge}" />
                        </Grid>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Challenges" Style="{StaticResource SectionGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <DataGrid Grid.Row="0"
                                  ItemsSource="{Binding Challenges}"
                                  SelectedItem="{Binding SelectedChallenge, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  MinHeight="220">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Created (UTC)" Binding="{Binding CreatedAtUtc}" Width="200" />
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
                                <DataGridTextColumn Header="Budget" Binding="{Binding Budget, StringFormat=C}" Width="120" />
                                <DataGridTextColumn Header="Used" Binding="{Binding Used, StringFormat=C}" Width="120" />
                                <DataGridTextColumn Header="Remaining" Binding="{Binding Remaining, StringFormat=C}" Width="130" />
                                <DataGridTextColumn Header="Active" Binding="{Binding IsActive}" Width="80" />
                            </DataGrid.Columns>
                        </DataGrid>

                        <DockPanel Grid.Row="1" Margin="0,14,0,0">
                            <Button x:Name="DeactivateSelectedButton" DockPanel.Dock="Right" Content="Deactivate selected"
                                    Style="{StaticResource Button.Secondary}"
                                    IsEnabled="{Binding CanDeactivateSelected}" />

                            <TextBlock VerticalAlignment="Center" Style="{StaticResource MutedText}">
                                Tip: Oldest active challenge is used first.
                            </TextBlock>
                        </DockPanel>
                    </Grid>
                </GroupBox>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer / status -->
        <Border Grid.Row="2" Background="{DynamicResource CG.Brush.Surface}" BorderBrush="{DynamicResource CG.Brush.Border}" BorderThickness="1" CornerRadius="10" Padding="12" Margin="0,8,0,0">
            <DockPanel>
                <Button x:Name="RefreshButton" DockPanel.Dock="Right" Content="Refresh" Style="{StaticResource Button.Secondary}" />
                <TextBlock VerticalAlignment="Center" Text="{Binding StatusText}" />
            </DockPanel>
        </Border>

    </Grid>
</Window>
