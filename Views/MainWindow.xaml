<Window x:Class="CheerfulGiverNXT.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="CheerfulGiverNXT Constituent Lookup"
        Height="720"
        Width="1100"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized" Background="{DynamicResource CG.Brush.WindowBackground}" Foreground="{DynamicResource CG.Brush.TextPrimary}">

    <Window.Resources>

        <!--
            ==================================================================
            THEME / DynamicResource QUICK GUIDE (MainWindow)
            ==================================================================

            This window intentionally DOES NOT hard=code colors. Instead it uses
            DynamicResource keys defined in:
              = Themes/Light.xaml
              = Themes/Dark.xaml

            Why DynamicResource?
              = When ThemeManager swaps the theme dictionary at runtime, the UI
                updates immediately without recreating windows or touching any
                workflow logic.

            Key=to=UI mapping you will most commonly tune:

              CG.Brush.WindowBackground
                = Window.Background (the overall app backdrop)

              CG.Brush.Surface / CG.Brush.SurfaceAlt
                = "Card" surfaces and secondary button fills
                = DataGrid Background and RowBackground

              CG.Brush.TextPrimary / CG.Brush.TextMuted
                = Normal text vs. helper/status text

              CG.Brush.Border / CG.Brush.BorderStrong
                = Card borders, DataGrid border, secondary button borders

              CG.Brush.InputBackground / CG.Brush.InputBorder
                = Search TextBox background and border

              CG.Brush.Accent / CG.Brush.AccentForeground
                = Primary buttons, progress bar fill, theme toggle "ON" state

              CG.Brush.GridLines / CG.Brush.GridAltRow
                = DataGrid line + alternating row color

              CG.Brush.ProgressTrack
                = Status bar progress bar background
        -->

        <!-- ===== Basic sizing (define BEFORE any StaticResource references) ===== -->
        <sys:Double xmlns:sys="clr-namespace:System;assembly=mscorlib" x:Key="Font.Base">16</sys:Double>
        <sys:Double xmlns:sys="clr-namespace:System;assembly=mscorlib" x:Key="Input.Height">34</sys:Double>
        <Thickness x:Key="Input.Padding">10,6,10,6</Thickness>
        <CornerRadius x:Key="Corner.Button">6</CornerRadius>

        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Implicit TextBlock: make all text readable by default -->
        <Style TargetType="{x:Type TextBlock}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <!-- ===== Text ===== -->
        <Style x:Key="LabelText" TargetType="{x:Type TextBlock}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- ===== Inputs ===== -->
        <Style x:Key="InputTextBox" TargetType="{x:Type TextBox}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="Padding" Value="{StaticResource Input.Padding}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>

            <!--
                INPUT BRUSHES
                = CG.Brush.InputBackground : TextBox fill
                = CG.Brush.TextPrimary     : typed text
                = CG.Brush.InputBorder     : border / focus ring baseline
                Tune in Themes/Light.xaml and Themes/Dark.xaml.
            -->
            <Setter Property="Background" Value="{DynamicResource CG.Brush.InputBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.InputBorder}"/>
        </Style>

        <!-- ===== Buttons (simple, easy to edit) ===== -->
        <ControlTemplate x:Key="ButtonTemplate.Rounded" TargetType="{x:Type Button}">
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{StaticResource Corner.Button}"
                    SnapsToDevicePixels="True">
                <ContentPresenter Margin="{TemplateBinding Padding}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  RecognizesAccessKey="True"
                                  TextElement.Foreground="{TemplateBinding Foreground}"/>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.92"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Opacity" Value="0.85"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.55"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style x:Key="Button.Primary" TargetType="{x:Type Button}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Padding" Value="14,4"/>

            <!--
                PRIMARY BUTTON BRUSHES
                = CG.Brush.Accent           : background + border
                = CG.Brush.AccentForeground : text
            -->
            <Setter Property="Background" Value="{DynamicResource CG.Brush.Accent}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.Accent}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.AccentForeground}"/>
            <Setter Property="Template" Value="{StaticResource ButtonTemplate.Rounded}"/>
        </Style>

        <Style x:Key="Button.Secondary" TargetType="{x:Type Button}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Padding" Value="14,4"/>

            <!--
                SECONDARY BUTTON BRUSHES
                = CG.Brush.SurfaceAlt   : background
                = CG.Brush.BorderStrong : border
                = CG.Brush.TextPrimary  : text
            -->
            <Setter Property="Background" Value="{DynamicResource CG.Brush.SurfaceAlt}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.BorderStrong}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextPrimary}"/>
            <Setter Property="Template" Value="{StaticResource ButtonTemplate.Rounded}"/>
        </Style>

        <!-- ===== DataGrid (fix "top heavy" cell text) ===== -->
        <Style x:Key="GridCellText" TargetType="{x:Type TextBlock}">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <!-- baseline nudge down 1px to avoid "top=heavy" look -->
            <Setter Property="Margin" Value="0,1,0,0"/>
        </Style>

        <Style x:Key="ResultsGrid" TargetType="{x:Type DataGrid}" BasedOn="{StaticResource {x:Type DataGrid}}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="RowHeight" Value="34"/>
            <Setter Property="ColumnHeaderHeight" Value="36"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>

            <!--
                DATAGRID BRUSHES
                = CG.Brush.GridLines  : horizontal separators
                = CG.Brush.GridAltRow : alternating row fill
                = CG.Brush.Border     : outer border
                = CG.Brush.Surface    : base background (rows + grid)
                = CG.Brush.TextPrimary: cell text default
            -->
            <Setter Property="HorizontalGridLinesBrush" Value="{DynamicResource CG.Brush.GridLines}"/>
            <Setter Property="VerticalGridLinesBrush" Value="Transparent"/>
            <Setter Property="AlternatingRowBackground" Value="{DynamicResource CG.Brush.GridAltRow}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.Surface}"/>
            <Setter Property="RowBackground" Value="{DynamicResource CG.Brush.Surface}"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextPrimary}"/>
        </Style>

        <Style x:Key="ResultsCell" TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource {x:Type DataGridCell}}">
            <Setter Property="Padding" Value="10,2,10,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

                        <!--
            ResultsHeader (DataGrid column header styling)
            =============================================
            This grid uses a slightly roomier header padding and header height.

            IMPORTANT:
              = The ACTUAL theming (Background/Foreground/SortArrow/Grippers/etc.) is applied
                globally in App.xaml via the default Style for DataGridColumnHeader.
              = That global style uses the DynamicResource keys below, so the header switches
                live when you toggle Light/Dark.

            DynamicResource brush mapping (tune these in Themes/Light.xaml + Themes/Dark.xaml):
              = CG.Brush.GridHeaderBackground        : normal header background
              = CG.Brush.GridHeaderForeground        : header text + sort arrow
              = CG.Brush.GridHeaderHoverBackground   : mouse=over background
              = CG.Brush.GridHeaderPressedBackground : pressed background
              = CG.Brush.GridHeaderBorder            : bottom border separating header from rows
        -->
        <Style x:Key="ResultsHeader"
               TargetType="{x:Type DataGridColumnHeader}"
               BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
            <!-- Slightly roomier padding for the MainWindow results list -->
            <Setter Property="Padding" Value="10,0,10,0"/>
        </Style>

        <!-- ===== Status bar progress (force Microsoft blue, align with status text) ===== -->
        <Style x:Key="StatusProgressBar" TargetType="{x:Type ProgressBar}">
            <!-- Microsoft blue (Windows 10 accent) -->
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.Accent}"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.ProgressTrack}"/>
            <!-- Match the larger status text better than the default tiny bar -->
            <Setter Property="Height" Value="18"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!--
            Theme toggle (non=intrusive)
            ============================
            This is a small "switch" shown in the MainWindow StatusBar.

            Brush usage:
              OFF state:
                = Track background: CG.Brush.SurfaceAlt
                = Track border:     CG.Brush.BorderStrong
              ON state:
                = Track background: CG.Brush.Accent
                = Track border:     CG.Brush.Accent
              Thumb:
                = CG.Brush.AccentForeground (kept high=contrast in both themes)
        -->
        <Style x:Key="ThemeToggle.Switch" TargetType="{x:Type ToggleButton}">
            <Setter Property="Width" Value="44"/>
            <Setter Property="Height" Value="22"/>
            <Setter Property="Background" Value="{DynamicResource CG.Brush.SurfaceAlt}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CG.Brush.BorderStrong}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="ToolTip" Value="Toggle Light/Dark theme"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Grid SnapsToDevicePixels="True">
                            <Border x:Name="Track"
                                    CornerRadius="11"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"/>

                            <Ellipse x:Name="Thumb"
                                     Width="18" Height="18"
                                     Fill="{DynamicResource CG.Brush.AccentForeground}"
                                     Margin="2,0,2,0"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"/>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Track" Property="Background" Value="{DynamicResource CG.Brush.Accent}"/>
                                <Setter TargetName="Track" Property="BorderBrush" Value="{DynamicResource CG.Brush.Accent}"/>
                                <Setter TargetName="Thumb" Property="HorizontalAlignment" Value="Right"/>
                            </Trigger>

                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.95"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ThemeToggle.Label" TargetType="{x:Type TextBlock}">
            <!-- Slightly smaller than your base UI font so it's informative but not "loud" -->
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{DynamicResource CG.Brush.TextMuted}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search row -->
        <DockPanel Grid.Row="0" LastChildFill="True" HorizontalAlignment="Center">
            <TextBlock Style="{StaticResource LabelText}" Text="Search:" Margin="0,0,8,8"/>
            <TextBox x:Name="SearchTextBox"
                     Style="{StaticResource InputTextBox}"
                     Width="420"
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     Margin="0,0,8,0"
                     ToolTip="Examples: Street # and street name | First name and part of last name | Phone # | Email"
                     KeyDown="SearchBox_KeyDown" VerticalContentAlignment="Bottom"/>

            <Button Content="Search"
                    Style="{StaticResource Button.Primary}"
                    Width="110"
                    Margin="0,0,8,0"
                    IsDefault="True"
                    Command="{Binding SearchCommand}"
                    IsEnabled="{Binding IsNotBusy}"/>

            <!-- Never primary: stays secondary and only shows when VM says not authorized 
            <Button x:Name="ButtonAuthorize" Content="Authorize this PC"
                    Style="{StaticResource Button.Secondary}"
                    Width="140"
                    Margin="0,0,8,0"
                    Command="{Binding LoginCommand}"
                    IsEnabled="{Binding IsNotBusy}"
                    Visibility="{Binding IsNotAuthorized, Converter={StaticResource BoolToVis}}"/> -->
        </DockPanel>

        <!-- Auth debug (read=only) -->
        <Expander Grid.Row="1"
                  Header="Authorization (read-only)"
                  IsExpanded="False"
                  Margin="0,10,0,10"
                  Visibility="Hidden">
            <Grid Margin="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelText}" Text="Machine:" Margin="0,0,8,6"/>
                <TextBox Grid.Row="0" Grid.Column="1" Style="{StaticResource InputTextBox}"
                         Text="{Binding MachineName, Mode=OneWay}" IsReadOnly="True" Margin="0,0,0,6"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Style="{StaticResource LabelText}" Text="Access Token:" Margin="0,0,8,6"/>
                <TextBox Grid.Row="1" Grid.Column="1" Style="{StaticResource InputTextBox}"
                         Text="{Binding AccessToken, Mode=OneWay}" IsReadOnly="True" Margin="0,0,0,6"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Style="{StaticResource LabelText}" Text="Subscription Key:" Margin="0,0,8,6"/>
                <TextBox Grid.Row="2" Grid.Column="1" Style="{StaticResource InputTextBox}"
                         Text="{Binding SubscriptionKey, Mode=OneWay}" IsReadOnly="True" Margin="0,0,0,6"/>

                <TextBlock Grid.Row="3" Grid.Column="1"
                           Foreground="{DynamicResource CG.Brush.TextMuted}"
                           Text="Tokens and subscription key are stored in SQL. Click “Authorize this PC” once per computer."
                           TextWrapping="Wrap"/>
            </Grid>
        </Expander>

        <!-- Results grid -->
        <DataGrid Grid.Row="2"
                  Style="{StaticResource ResultsGrid}"
                  CellStyle="{StaticResource ResultsCell}"
                  ColumnHeaderStyle="{StaticResource ResultsHeader}"
                  ItemsSource="{Binding Results}"
                  SelectedItem="{Binding SelectedRow}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  SelectionUnit="FullRow"
                  MouseDoubleClick="ResultsGrid_MouseDoubleClick"
                  EnableRowVirtualization="True"
                  EnableColumnVirtualization="True">
            <DataGrid.Columns>

                <DataGridTextColumn Header="Constituent ID" Binding="{Binding Id}" Width="150" MinWidth="150"
                                    ElementStyle="{StaticResource GridCellText}"/>

                <DataGridTextColumn Header="Full name" Binding="{Binding FullName}" Width="1*" MinWidth="170"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="Spouse" Binding="{Binding Spouse}" Width="1.5*" MinWidth="220"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="Contact" Binding="{Binding Contact}" Width="2*" MinWidth="300"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="Street address" Binding="{Binding Street}" Width="3*" MinWidth="360"
                                    ElementStyle="{StaticResource GridCellText}"/>

                <DataGridTextColumn Header="City" Binding="{Binding City}" Width="1.5*" MinWidth="180"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="State" Binding="{Binding State}" Width="90"
                                    ElementStyle="{StaticResource GridCellText}"/>

                <DataGridTextColumn Header="ZIP" Binding="{Binding Zip}" Width="1*" MinWidth="120"
                                    ElementStyle="{StaticResource GridCellText}"/>

            </DataGrid.Columns>
        </DataGrid>

        <!-- Status bar -->
        <StatusBar Grid.Row="3" Margin="0,10,0,0">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}" />
            </StatusBarItem>

            <StatusBarItem>
                <TextBlock x:Name="ModeIndicatorTextBlock"
                           Foreground="{DynamicResource CG.Brush.TextMuted}"
                           Margin="16,0,0,0"
                           Text="Mode: Live" />
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Right" DockPanel.Dock="Right">
                <TextBlock x:Name="TokenCountdownTextBlock"
                           Foreground="{DynamicResource CG.Brush.TextMuted}"
                           Margin="0,0,10,0"
                           TextAlignment="Right"/>
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Center">
                <ProgressBar Style="{StaticResource StatusProgressBar}"
                             Width="180"
                             IsIndeterminate="True"
                             Visibility="{Binding BusyVisibility}"/>
            </StatusBarItem>

            <!--
                Theme toggle (Light/Dark)
                = This is intentionally small and kept in the StatusBar so it
                  doesn't clutter the main workflow UI.
                = The label text is updated in MainWindow.xaml.cs so it always
                  reflects the current theme mode.
            -->
            <StatusBarItem HorizontalAlignment="Right" DockPanel.Dock="Right">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <ToggleButton x:Name="ThemeToggleButton"
                                  Style="{StaticResource ThemeToggle.Switch}"
                                  Checked="ThemeToggle_Checked"
                                  Unchecked="ThemeToggle_Unchecked"/>
                    <TextBlock x:Name="ThemeToggleLabel"
                               Style="{StaticResource ThemeToggle.Label}"
                               Text="Light"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
