<Window x:Class="CheerfulGiverNXT.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="CheerfulGiverNXT Constituent Lookup"
        Height="720"
        Width="1100"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <Window.Resources>
        
        <!-- Implicit TextBlock: make all text readable by default -->
        <Style TargetType="{x:Type TextBlock}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

<BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- ===== Basic sizing ===== -->
        <sys:Double xmlns:sys="clr-namespace:System;assembly=mscorlib" x:Key="Font.Base">16</sys:Double>
        <sys:Double xmlns:sys="clr-namespace:System;assembly=mscorlib" x:Key="Input.Height">34</sys:Double>
        <Thickness x:Key="Input.Padding">10,6,10,6</Thickness>
        <CornerRadius x:Key="Corner.Button">6</CornerRadius>

        <!-- ===== Text ===== -->
        <Style x:Key="LabelText" TargetType="{x:Type TextBlock}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- ===== Inputs ===== -->
        <Style x:Key="InputTextBox" TargetType="{x:Type TextBox}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="Padding" Value="{StaticResource Input.Padding}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- ===== Buttons (simple, easy to edit) ===== -->
        <ControlTemplate x:Key="ButtonTemplate.Rounded" TargetType="{x:Type Button}">
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{StaticResource Corner.Button}"
                    SnapsToDevicePixels="True">
                <ContentPresenter Margin="{TemplateBinding Padding}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  RecognizesAccessKey="True"
                                  TextElement.Foreground="{TemplateBinding Foreground}"/>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.92"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Opacity" Value="0.85"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.55"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style x:Key="Button.Primary" TargetType="{x:Type Button}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Padding" Value="14,4"/>
            <Setter Property="Background" Value="#FF0078D4"/>
            <Setter Property="BorderBrush" Value="#FF0078D4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template" Value="{StaticResource ButtonTemplate.Rounded}"/>
        </Style>

        <Style x:Key="Button.Secondary" TargetType="{x:Type Button}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="Height" Value="{StaticResource Input.Height}"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Padding" Value="14,4"/>
            <Setter Property="Background" Value="#FFF3F3F3"/>
            <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="#FF111111"/>
            <Setter Property="Template" Value="{StaticResource ButtonTemplate.Rounded}"/>
        </Style>

        <!-- ===== DataGrid (fix "top heavy" cell text) ===== -->
        <Style x:Key="GridCellText" TargetType="{x:Type TextBlock}">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <!-- baseline nudge down 1px to avoid "top-heavy" look -->
            <Setter Property="Margin" Value="0,1,0,0"/>
        </Style>

        <Style x:Key="ResultsGrid" TargetType="{x:Type DataGrid}">
            <Setter Property="FontSize" Value="{StaticResource Font.Base}"/>
            <Setter Property="RowHeight" Value="34"/>
            <Setter Property="ColumnHeaderHeight" Value="36"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#FFE6E6E6"/>
            <Setter Property="VerticalGridLinesBrush" Value="Transparent"/>
            <Setter Property="AlternatingRowBackground" Value="#FFF9F9F9"/>
            <Setter Property="BorderBrush" Value="#FFDDDDDD"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="ResultsCell" TargetType="{x:Type DataGridCell}">
            <Setter Property="Padding" Value="10,2,10,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="ResultsHeader" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Padding" Value="10,0,10,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- ===== Status bar progress (force Microsoft blue, align with status text) ===== -->
        <Style x:Key="StatusProgressBar" TargetType="{x:Type ProgressBar}">
            <!-- Microsoft blue (Windows 10 accent) -->
            <Setter Property="Foreground" Value="#FF0078D4"/>
            <Setter Property="Background" Value="#FFE6E6E6"/>
            <!-- Match the larger status text better than the default tiny bar -->
            <Setter Property="Height" Value="18"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search row -->
        <DockPanel Grid.Row="0" LastChildFill="True" HorizontalAlignment="Center">
            <TextBlock Style="{StaticResource LabelText}" Text="Search:" Margin="0,0,8,8"/>
            <TextBox x:Name="SearchTextBox"
                     Style="{StaticResource InputTextBox}"
                     Width="420"
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     Margin="0,0,8,0"
                     ToolTip="Examples: Street # and street name | First name and part of last name | Phone # | Email"
                     KeyDown="SearchBox_KeyDown" VerticalContentAlignment="Bottom"/>

            <Button Content="Search"
                    Style="{StaticResource Button.Primary}"
                    Width="110"
                    Margin="0,0,8,0"
                    IsDefault="True"
                    Command="{Binding SearchCommand}"
                    IsEnabled="{Binding IsNotBusy}"/>

            <!-- Never primary: stays secondary and only shows when VM says not authorized 
            <Button x:Name="ButtonAuthorize" Content="Authorize this PC"
                    Style="{StaticResource Button.Secondary}"
                    Width="140"
                    Margin="0,0,8,0"
                    Command="{Binding LoginCommand}"
                    IsEnabled="{Binding IsNotBusy}"
                    Visibility="{Binding IsNotAuthorized, Converter={StaticResource BoolToVis}}"/> -->
        </DockPanel>

        <!-- Auth debug (read-only) -->
        <Expander Grid.Row="1"
                  Header="Authorization (read-only)"
                  IsExpanded="False"
                  Margin="0,10,0,10"
                  Visibility="Hidden">
            <Grid Margin="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelText}" Text="Machine:" Margin="0,0,8,6"/>
                <TextBox Grid.Row="0" Grid.Column="1" Style="{StaticResource InputTextBox}"
                         Text="{Binding MachineName, Mode=OneWay}" IsReadOnly="True" Margin="0,0,0,6"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Style="{StaticResource LabelText}" Text="Access Token:" Margin="0,0,8,6"/>
                <TextBox Grid.Row="1" Grid.Column="1" Style="{StaticResource InputTextBox}"
                         Text="{Binding AccessToken, Mode=OneWay}" IsReadOnly="True" Margin="0,0,0,6"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Style="{StaticResource LabelText}" Text="Subscription Key:" Margin="0,0,8,6"/>
                <TextBox Grid.Row="2" Grid.Column="1" Style="{StaticResource InputTextBox}"
                         Text="{Binding SubscriptionKey, Mode=OneWay}" IsReadOnly="True" Margin="0,0,0,6"/>

                <TextBlock Grid.Row="3" Grid.Column="1"
                           Foreground="Gray"
                           Text="Tokens and subscription key are stored in SQL. Click “Authorize this PC” once per computer."
                           TextWrapping="Wrap"/>
            </Grid>
        </Expander>

        <!-- Results grid -->
        <DataGrid Grid.Row="2"
                  Style="{StaticResource ResultsGrid}"
                  CellStyle="{StaticResource ResultsCell}"
                  ColumnHeaderStyle="{StaticResource ResultsHeader}"
                  ItemsSource="{Binding Results}"
                  SelectedItem="{Binding SelectedRow}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  SelectionUnit="FullRow"
                  MouseDoubleClick="ResultsGrid_MouseDoubleClick"
                  EnableRowVirtualization="True"
                  EnableColumnVirtualization="True">
            <DataGrid.Columns>

                <DataGridTextColumn Header="Constituent ID" Binding="{Binding Id}" Width="150" MinWidth="150"
                                    ElementStyle="{StaticResource GridCellText}"/>

                <DataGridTextColumn Header="Full name" Binding="{Binding FullName}" Width="1*" MinWidth="170"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="Spouse" Binding="{Binding Spouse}" Width="1.5*" MinWidth="220"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="Contact" Binding="{Binding Contact}" Width="2*" MinWidth="300"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="Street address" Binding="{Binding Street}" Width="3*" MinWidth="360"
                                    ElementStyle="{StaticResource GridCellText}"/>

                <DataGridTextColumn Header="City" Binding="{Binding City}" Width="1.5*" MinWidth="180"
                                    ElementStyle="{StaticResource GridCellText}"/>
                <DataGridTextColumn Header="State" Binding="{Binding State}" Width="90"
                                    ElementStyle="{StaticResource GridCellText}"/>

                <DataGridTextColumn Header="ZIP" Binding="{Binding Zip}" Width="1*" MinWidth="120"
                                    ElementStyle="{StaticResource GridCellText}"/>

            </DataGrid.Columns>
        </DataGrid>

        <!-- Status bar -->
        <StatusBar Grid.Row="3" Margin="0,10,0,0">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}" />
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="TokenCountdownTextBlock"
                           Foreground="Gray"
                           Margin="0,0,10,0"
                           TextAlignment="Right"/>
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Center">
                <ProgressBar Style="{StaticResource StatusProgressBar}"
                             Width="180"
                             IsIndeterminate="True"
                             Visibility="{Binding BusyVisibility}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
